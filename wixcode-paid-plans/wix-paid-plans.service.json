{ "name": "wix-paid-plans",
  "mixes": [],
  "labels": [],
  "location":
    { "lineno": 2,
      "filename": "paid-plans.js" },
  "docs":
    { "summary": "The wix-paid-plans module contains functionality for working with\n paid plans from client-side code.",
      "description":
        [ "Using the Paid Plans API, you can build a customized membership plan experience.",
          "",
          "First, set up your site to:",
          "",
          " * Accept payments as described in <a href=\"https://support.wix.com/en/article/about-accepting-payments\" target=\"_blank\">About Accepting Payments</a>.",
          "",
          " * Offer membership plans as described in <a href=\"https://support.wix.com/en/article/about-paid-plans\" target=\"_blank\">About Paid Plans</a>. When setting up your site to accept paid plans, <a href=\"https://support.wix.com/en/article/creating-a-plan-in-paid-plans\" target=\"_blank\">",
          "   define the plans you want to offer</a>.",
          "",
          "",
          " When plans are set up, you can use the API to:",
          "",
          " <ul>",
          " <li>Get information about paid plans.</li>",
          " <li>Let site visitors purchase a plan directly, as if they were using the Paid Plans app.</li>",
          " <li>Let site visitors purchase a plan using your own customized process.</li>",
          " <li>Let site visitors cancel plan subscriptions (orders) that they have purchased.</li>",
          " </ul>",
          "",
          "",
          "",
          "",
          "There are two flows for setting up paid plans: Direct purchases and customized purchases.",
          "",
          "",
          "",
          " <h3 id=\"paid-plan-lifecycle\">Direct Purchase of a Paid Plan</h3>",
          "",
          " Direct purchasing is the same as when purchasing a plan with the Paid Plans app. Everything is",
          " handled, from requesting the plan, through paying for the plan. If you need",
          " standard paid plan processing, call the [`purchasePlan()`](wix-paid-plans.html#purchasePlan) function.",
          "",
          "",
          "",
          " The following outlines the steps in a direct-purchase lifecycle:",
          "",
          " 1. Get a list of membership plans from one of:",
          "    * A dataset connected to the Plans collection.",
          "    * A query on the Plans collection.",
          " 1. A *logged-in* site visitor selects a membership plan by clicking the plan or a button. (If the visitor is not logged-in, the",
          "    sign up page is displayed.)",
          " 1. The corresponding event handler calls a function to handle all stages of buying the plan (ordering, purchasing, and payment):",
          "    * If the plan is free, the plan is immediately ordered and is considered purchased (transaction status is \"Paid\").",
          "    * If the plan is not free, the plan is ordered but not yet purchased (transaction status is \"Pending\"). The site visitor fills in contact",
          "      details and selects a payment method (transaction status is now \"Paid\").",
          " 1. Handle additional updates when a plan is successfully purchased using the",
          "    [`onPlanPurchased()`](wix-paid-plans-backend.Events.html#onPlanPurchased) event.*",
          "",
          "",
          "",
          "",
          " <h3 id=\"paid-plan-customize\">Customized Paid Plan Purchases</h3>",
          "",
          " Let site visitors order a plan for future purchase (such as after a visitor enters payment information).",
          " You customize the entire process of selecting, requesting, and",
          " paying for a plan. You can add elements, such as confirmation lightboxes and forms, to customize the visitor experience.",
          "",
          "",
          " To let the visitor request a plan, call the [`orderPlan()`](wix-paid-plans.html#orderPlan) function.",
          "",
          "",
          " The following outlines the steps for customizing the paid plan purchase:",
          "",
          " 1. Get a list of membership plans from one of:",
          "    * A dataset connected to the Plans collection.",
          "    * A query on the Plans collection.",
          " 1. A *logged-in* site visitor selects a membership plan by clicking the plan or a button.  (If the visitor is not logged-in, the",
          "    sign up page is displayed.)",
          " 1. The corresponding event handler calls the [`orderPlan()`](wix-paid-plans.html#orderPlan) function to handle the initial order of the plan.",
          " 1. The site visitor uses a series of customized elements, such as lightboxes, and forms.",
          " 1. The site visitor uses the Wix Pay payment method to complete the purchase.",
          " 1. Handle additional updates when a plan is successfully purchased using the",
          "    [`onPlanPurchased()`](wix-paid-plans-backend.Events.html#onPlanPurchased) event.*",
          "",
          "",
          "",
          " To use the Paid Plans API, import `wixPaidPlans` from the `wix-paid-plans` module:",
          "",
          "   ```javascript",
          "   import wixPaidPlans from 'wix-paid-plans';",
          "   ```" ],
      "links": [],
      "examples": [],
      "extra":
        {  } },
  "properties": [],
  "operations":
    [ { "name": "cancelOrder",
        "labels": [],
        "nameParams": [],
        "params":
          [ { "name": "orderId",
              "type": "string",
              "doc": "The plan subscription's order ID." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "void" ] },
            "doc": "Fulfilled - When the subscription is cancelled.\nRejected - Error message." },
        "locations":
          [ { "lineno": 233,
              "filename": "paid-plans.js" } ],
        "docs":
          { "summary": "Cancels a specific order (subscription) of a plan.",
            "description":
              [ "The `cancelOrder()` function cancels an order (subscription) of a plan, after verifying that the site member is logged in.",
                "",
                " Keep in mind that a site member can order several subscriptions of the same plan. This API does not",
                " cancel the plan and remove all corresponding subscriptions. This API removes only the one order (subscription) of the plan." ],
            "links": [],
            "examples":
              [ { "title": "Cancel an order (subscription) on button click",
                  "body":
                    [ "import wixPaidPlans from 'wix-paid-plans'; ",
                      "import wixWindow from 'wix-window';        ",
                      "",
                      "const orderId = // Get the order ID of the subscription to cancel",
                      "",
                      "// Call cancelOrder() when user clicks button",
                      "export function cancelButton_click(event) {  ",
                      "",
                      "  wixPaidPlans.cancelOrder(orderId) ",
                      "",
                      "    // Additional processing based on cancellation results",
                      "    .then ( () => {",
                      "       wixWindow.openLightbox(\"orderCanceled\")",
                      "      } )",
                      "     .catch( (err) => {",
                      "       wixWindow.openLightbox(\"cancelFailed\")",
                      "     } );",
                      "  }" ],
                  "extra":
                    {  } },
                { "title": "A full cancel order (subscription) scenario",
                  "body":
                    [ "import wixPaidPlans from 'wix-paid-plans';  ",
                      "import wixData from 'wix-data';             ",
                      "import wixUsers from 'wix-users';           ",
                      "import wixWindow from 'wix-window';         ",
                      "",
                      "$w.onReady(function () {",
                      "  $w('#subscriptionDataset').onReady( () => {",
                      "",
                      "     // Get the order ID for the subscription to cancel",
                      "     const subscription = $w(\"#subscriptionDataset\").getCurrentItem();   ",
                      "     const orderId = subscription.orderId; ",
                      "",
                      "     $w(\"cancelButton\").onClick( (event) => {",
                      "",
                      "       // Cancel the specific subscription of the plan ",
                      "       wixPaidPlans.cancelOrder(orderId)",
                      "        .then( () => {",
                      "",
                      "        // Let user know that cancellation succeeded",
                      "\t      wixWindow.openLightbox(\"orderCanceled\");",
                      "",
                      "        // Get details for updating status of existing subscription",
                      "        const user = wixUsers.currentUser;   ",
                      "\t      const toUpdate = {",
                      "\t\t \t  \"_id\":         subscription._id,",
                      "\t\t \t  \"planName\":    subscription.planName,",
                      "\t\t \t  \"planId\":      subscription.planId,",
                      "\t\t \t  \"orderId\":     subscription.orderId,",
                      "              \"memberId\":    user.id,",
                      "              \"dateCreated\": subscription.dateCreated,",
                      "              \"canceled\":    true,            // Set cancellation to true",
                      "              \"dateUpdated\": Date().toString()\t\t",
                      "          };",
                      "    ",
                      "          // Update subscription in collection to show the subscription is canceled",
                      "          wixData.update(\"Subscriptions\", toUpdate)",
                      "",
                      "\t     // Let user know if cancellation failed",
                      "  \t     .catch((err) => {",
                      "\t        wixWindow.openLightbox(\"cancelFailed\");",
                      "\t      });",
                      "\t   })",
                      "\t})",
                      "  })",
                      "})",
                      "",
                      "" ],
                  "extra":
                    { "description": "This example demonstrates a full scenario for cancelling a paid plan order (subscription).\n\n In the interest of simplicity the code does not deal with display considerations or validations\n that would normally be required to make sure users perform the flow as\n intended.\n\n Customized elements include:\n\n + A `Subscriptions` collection. This collection contains all plan orders (subscriptions) purchased by the site member and each subscription's status.\n + A `cancelButton` button that the site member clicks to cancel an order (subscription) of a plan.\n + A `subscriptionDataset` dataset that connects the page to the `Subscriptions` collection.\n + Two lightboxes, `orderCanceled` and `cancelFailed` that notify the site member if a subscription is cancelled." } } ],
            "extra":
              {  } },
        "extra":
          { "notes":
              [ "To work with the Paid Plans API, you need to publish your site." ] } },
      { "name": "orderPlan",
        "labels": [],
        "nameParams": [],
        "params":
          [ { "name": "planId",
              "type": "string",
              "doc": "The plan ID." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "wix-paid-plans.OrderResult" ] },
            "doc": "Fulfilled - The created order.\nRejected - Error message." },
        "locations":
          [ { "lineno": 168,
              "filename": "paid-plans.js" } ],
        "docs":
          { "summary": "Orders a paid plan.",
            "description":
              [ "To process paid plans on your site, first set up your site to offer paid plans",
                " as described in <a href=\"https://support.wix.com/en/article/about-paid-plans\" target=\"_blank\">About Paid Plans</a>.",
                " When setting up your site to accept paid plans, <a href=\"https://support.wix.com/en/article/creating-a-plan-in-paid-plans\" target=\"_blank\">",
                " define the plans you want to offer</a>.",
                "",
                " The `orderPlan()` function returns a Promise that resolves to an [`OrderResult`](wix-paid-plans.html#OrderResult)",
                " object when the visitor completes the order process. Use this result only for display purposes.",
                "",
                " Ordering a plan places an order for the plan, without actually purchasing it. You can then continue the",
                " payment process with the Wix Pay payment method, which applies the plan to the visitor on completion of payment.",
                "",
                " To understand how `orderPlan()` is used in a customized paid plan lifecycle,",
                " see [Customized Paid Plan Purchases](wix-paid-plans.html#paid-plan-customize)." ],
            "links": [],
            "examples":
              [ { "title": "Order a paid plan",
                  "body":
                    [ "import wixPaidPlans from 'wix-paid-plans';",
                      "",
                      "let planId = // Get the plan ID",
                      "",
                      "export function myOrderButton_click(event) {",
                      "  wixPaidPlans.orderPlan(planId)",
                      "    .then( (myOrder) => {",
                      "        let myOrderId = myOrder.orderId;",
                      "        let myWixPayOrderId = myOrder.wixPayOrderId;",
                      "    } );",
                      "  }",
                      "",
                      "",
                      "/* myOrder:",
                      " * {",
                      " *  \"orderId\": \\\"b3fb3a4d-c223-4040-8bc3-8dfdefb1bafc\\\",",
                      " *  \"wixPayOrderId\": \\\"06af8fd6-6c82-4b51-bc08-0b556aad6f4f\\\"",
                      " * }",
                      " */" ],
                  "extra":
                    {  } },
                { "title": "A full order plan scenario",
                  "body":
                    [ "/****************************************",
                      "* Code on a plan viewer page",
                      "*****************************************/",
                      "// For navigating to a dynamic page:",
                      "import wixLocation from 'wix-location';",
                      "// If the site visitor clicks a plan's button,",
                      "// the browser relocates to that plan's dynamic page,",
                      "// with more details.",
                      "$w.onReady(function () {",
                      "   $w(\"#viewButton\").onClick( (event, $w) => {",
                      "      let slug = $w(\"#planDataset\").getCurrentItem().slug;",
                      "",
                      "      // We customized the URL to the plan's dynamic",
                      "      // page when we created it. ",
                      "      wixLocation.to('/my-plans/'+ slug)",
                      "  }));",
                      "});",
                      "",
                      "",
                      "/****************************************",
                      "* Code on a plan ordering dynamic page",
                      "*****************************************/",
                      "// For a lightbox:",
                      "import wixWindow from 'wix-window';",
                      "// For Wix Pay, but any payment method is OK:",
                      "import wixPay from 'wix-pay';",
                      "// For paid plans",
                      "import paidPlans from 'wix-paid-plans';",
                      "",
                      "",
                      "$w.onReady(function () {",
                      "",
                      "   // When the collection is accessible...",
                      "   $w('#dynamicDataset').onReady( () => {",
                      "",
                      "   // Assign the currently-selected plan to currentPlanObject",
                      "   const currentPlanObject = $w(\"#dynamicDataset\").getCurrentItem();",
                      "",
                      "   // Display details about the current plan",
                      "   $w('#planName').text = currentPlanObject.name;",
                      "   $w('#planDescription').text = currentPlanObject.description;",
                      "",
                      "   // Assign the currently-selected plan's ID to planId. This",
                      "   // unique identifier will be used for ordering the plan.",
                      "   const planId = currentPlanObject._id;",
                      "",
                      "",
                      "   // Order the plan by button click",
                      "   $w(\"orderPlanButton\").onClick( (event) => {",
                      "",
                      "   // Provide the plan's ID to the",
                      "   // orderPlan() function. The function returns",
                      "   // an object containing the plan's properties.",
                      "   const order = paidPlans.orderPlan(planId).then(ord => {",
                      "",
                      "   const planWithOrder = {",
                      "     plan: currentPlanObject,",
                      "     order: ord",
                      "   };",
                      "",
                      "   // Use a customized lightbox to continue processing the order.",
                      "   wixWindow.openLightbox(\"orderCreated\", planWithOrder)",
                      "     .then( (data) => {",
                      "     const receivedData = data;",
                      "   });",
                      "",
                      "   });",
                      "  });",
                      " });",
                      "});",
                      "" ],
                  "extra":
                    { "description": "This example demonstrates a customized paid plans scenario. The customized elements include:\n\n\n * An intermediary page that displays all plans before ordering\n * A lightbox\n\n\n In the interest of simplicity the code does not deal with display considerations or validations\n that would normally be required to make sure users perform the flow as\n intended.\n\n The code assumes 2 pages:\n\n * The plan viewer page lists the plans and lets the visitor pick one.\n\n * A dynamic page shows one plan's details and lets the visitor order the plan.\n\n\n The plan viewer page has the following elements:\n\n + `planDataset`: Connects the page to the Plans collection.\n + `planRepeater`: Displays fields for each plan.\n + `viewButton`: Displays the ordering page for the selected plan.\n\n\n\nThe dynamic page has the following elements:\n\n + `dynanicDataset`: Connects the page to the Plans collection.\n + `planName`: Text element that displays the plan's name.\n + `planDescription`: Text element that displays the plan's tagline.\n + `orderPlanButton`: Performs a request to order the plan.\n + `orderCreated`: A customized lighbox. The lightbox could, for example,\n    display plan details and ask for additional confirmation." } } ],
            "extra":
              {  } },
        "extra":
          { "notes":
              [ "To work with the Paid Plans API, you need to publish your site." ] } },
      { "name": "purchasePlan",
        "labels": [],
        "nameParams": [],
        "params":
          [ { "name": "planId",
              "type": "string",
              "doc": "The plan ID." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "wix-paid-plans.PurchaseResult" ] },
            "doc": "Fulfilled - The created purchase." },
        "locations":
          [ { "lineno": 134,
              "filename": "paid-plans.js" } ],
        "docs":
          { "summary": "Orders and purchases a paid plan.",
            "description":
              [ "To process paid plans on your site, first set up your site to offer paid plans",
                " as described in <a href=\"https://support.wix.com/en/article/about-paid-plans\" target=\"_blank\">About Paid Plans</a>.",
                " When setting up your site to accept paid plans, <a href=\"https://support.wix.com/en/article/creating-a-plan-in-paid-plans\" target=\"_blank\"> define the plans you want to offer</a>,",
                " including the payment method.",
                "",
                " The `purchasePlan()` function returns a Promise that resolves to either a [`PurchaseResult`](wix-paid-plans.html#PurchaseResult)",
                " object when the visitor completes the purchase process for a non-free plan, or a  [`PurchaseResultFree`](wix-paid-plans.html#PurchaseResultFree)",
                " object when the visitor completes the purchase process for a free plan. Use this result only for display purposes.",
                "",
                "",
                " Purchasing a plan orders the plan, and continues the",
                " payment process with the Wix Pay API. After payment is complete, the plan",
                " is assigned to the visitor.",
                "",
                " To understand the lifecycle of how `purchasePlan()` is used,",
                " see [Direct Purchase of a Paid Plan](wix-paid-plans.html#paid-plan-lifecycle)." ],
            "links": [],
            "examples":
              [ { "title": "Purchase a non-free plan on button click",
                  "body":
                    [ "import wixPaidPlans from 'wix-paid-plans';",
                      "import wixPay from 'wix-paid-plans';",
                      "",
                      "let planId = // Get the plan ID for a non-free plan",
                      "",
                      "export function myPurchaseButton_click(event) {",
                      "  wixPaidPlans.purchasePlan(planId)",
                      "    .then( (myPurchase) => {",
                      "        let myOrderId = myPurchase.orderId;",
                      "        let myWixPayOrderId = myPurchase.wixPayOrderId;",
                      "        let myWixPayStatus = myPurchase.wixPayStatus;",
                      "    } );",
                      "  }",
                      "",
                      "",
                      "/* myPurchase:",
                      " * {",
                      " *  \"orderId\": \\\"b3fb3a4d-c223-4040-8bc3-8dfdefb1bafc\\\",",
                      " *  \"wixPayOrderId\": \\\"06af8fd6-6c82-4b51-bc08-0b556aad6f4f\\\",",
                      " *  \"wixPayStatus\": \\\"Successful\"",
                      " * }",
                      " */" ],
                  "extra":
                    {  } },
                { "title": "Purchase a free plan on button click",
                  "body":
                    [ "import wixPaidPlans from 'wix-paid-plans';",
                      "import wixPay from 'wix-paid-plans';",
                      "",
                      "let planId = // Get the plan ID for a free plan",
                      "",
                      "export function myPurchaseButton_click(event) {",
                      "  wixPaidPlans.purchasePlan(planId)",
                      "    .then( (myPurchase) => {",
                      "        let myOrderId = myPurchase.orderId;",
                      "    } );",
                      "  }",
                      "",
                      "",
                      "/* myPurchase:",
                      " * {",
                      " *  \"orderId\": \\\"b3fb3a4d-c223-4040-8bc3-8dfdefb1bafc\\\"",
                      " * }",
                      " */" ],
                  "extra":
                    {  } } ],
            "extra":
              {  } },
        "extra":
          { "notes":
              [ "To work with the Paid Plans API, you need to publish your site." ] } } ],
  "callbacks": [],
  "messages":
    [ { "name": "OrderResult",
        "locations":
          [ { "lineno": 123,
              "filename": "paid-plans.js" } ],
        "docs":
          { "summary": "An object representing an order result.",
            "links":
              [ "[orderPlan( )](wix-paid-plans.html#orderPlan)" ],
            "examples":
              [ { "title": "Order a paid plan",
                  "body":
                    [ "import wixPaidPlans from 'wix-paid-plans';",
                      "",
                      "let planId = // Get the plan ID",
                      "",
                      "export function myOrderButton_click(event) {",
                      "  wixPaidPlans.orderPlan(planId)",
                      "    .then( (myOrder) => {",
                      "        let myOrderId = myOrder.orderId;",
                      "        let myWixPayOrderId = myOrder.wixPayOrderId;",
                      "    } );",
                      "  }",
                      "",
                      "",
                      "/* myOrder:",
                      " * {",
                      " *  \"orderId\": \\\"b3fb3a4d-c223-4040-8bc3-8dfdefb1bafc\\\",",
                      " *  \"wixPayOrderId\": \\\"06af8fd6-6c82-4b51-bc08-0b556aad6f4f\\\"",
                      " * }",
                      " */" ],
                  "extra":
                    {  } } ],
            "extra":
              {  } },
        "members":
          [ { "name": "orderId",
              "type": "string",
              "doc": "ID of the order." },
            { "name": "wixPayOrderId",
              "type": "string",
              "doc": "Wix Pay ID of the order being purchased." } ],
        "extra":
          {  },
        "labels": [] },
      { "name": "PurchaseResult",
        "locations":
          [ { "lineno": 93,
              "filename": "paid-plans.js" } ],
        "docs":
          { "summary": "An object representing a purchase result for a non-free plan.",
            "links":
              [ "[purchasePlan( )](wix-paid-plans.html#purchasePlan)" ],
            "examples":
              [ { "title": "Purchase a non-free plan",
                  "body":
                    [ "import wixPaidPlans from 'wix-paid-plans';",
                      "import wixPay from 'wix-paid-plans';",
                      "",
                      "let planId = // Get the plan ID for a non-free plan",
                      "",
                      "export function myPurchaseButton_click(event) {",
                      "  wixPaidPlans.purchasePlan(planId)",
                      "    .then( (myPurchase) => {",
                      "        let myOrderId = myPurchase.orderId;",
                      "        let myWixPayOrderId = myPurchase.wixPayOrderId;",
                      "        let myWixPayStatus = myPurchase.wixPayStatus;",
                      "    } );",
                      "  }",
                      "",
                      "",
                      "/* myPurchase:",
                      " * {",
                      " *  \"orderId\": \\\"b3fb3a4d-c223-4040-8bc3-8dfdefb1bafc\\\",",
                      " *  \"wixPayOrderId\": \\\"06af8fd6-6c82-4b51-bc08-0b556aad6f4f\\\",",
                      " *  \"wixPayStatus\": \\\"Successful\"",
                      " * }",
                      " */" ],
                  "extra":
                    {  } } ],
            "extra":
              {  } },
        "members":
          [ { "name": "orderId",
              "type": "string",
              "doc": "ID of the order being purchased." },
            { "name": "wixPayOrderId",
              "type": "string",
              "doc": "Wix Pay ID of the order being purchased. Returned for non-free plans." },
            { "name": "wixPayStatus",
              "type": "string",
              "doc": "Payment status in Wix Pay. One of:\n\n + \"`Successful`\": Payment was successfully received.\n + \"`Pending`\": Payment is pending payment provider approval.\n + \"`Failed`\": Payment has failed.\n + \"`Chargeback`\": Payment is chargeback.\n + \"`Refunded`\": Payment was fully refunded.\n + \"`Offline`\": Payment will be executed offline.\n + \"`PartiallyRefunded`\": Payment was partially refunded.\n + \"`Cancelled`\": Payment was cancelled and was not processed.\n + \"`Undefined`\": Payment status is pending payment provider input." } ],
        "extra":
          {  },
        "labels": [] },
      { "name": "PurchaseResultFree",
        "locations":
          [ { "lineno": 114,
              "filename": "paid-plans.js" } ],
        "docs":
          { "summary": "An object representing a purchase result for a free plan.",
            "links":
              [ "[purchasePlan( )](wix-paid-plans.html#purchasePlan)" ],
            "examples":
              [ { "title": "Purchase a free plan",
                  "body":
                    [ "import wixPaidPlans from 'wix-paid-plans';",
                      "import wixPay from 'wix-paid-plans';",
                      "",
                      "let planId = // Get the plan ID for a free plan",
                      "",
                      "export function myPurchaseButton_click(event) {",
                      "  wixPaidPlans.purchasePlan(planId)",
                      "    .then( (myPurchase) => {",
                      "        let myOrderId = myPurchase.orderId;",
                      "    } );",
                      "  }",
                      "",
                      "",
                      "/* myPurchase:",
                      " * {",
                      " *  \"orderId\": \\\"b3fb3a4d-c223-4040-8bc3-8dfdefb1bafc\\\"",
                      " * }",
                      " */" ],
                  "extra":
                    {  } } ],
            "extra":
              {  } },
        "members":
          [ { "name": "orderId",
              "type": "string",
              "doc": "ID of the order being purchased." } ],
        "extra":
          {  },
        "labels": [] } ],
  "extra":
    { "notes":
        [ "To work with the Paid Plans API, you need to publish your site." ] },
  "menuSections": "APIs",
  "relatedContent": [],
  "FAQs": [] }