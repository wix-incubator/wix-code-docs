# Migrate from `wix-data` to the Data Items SDK

As part of Wix's [transition](https://dev.wix.com/docs/velo/articles/api-overview/about-using-the-sdk) from Velo to the next-generation JavaScript SDK, you can now use the [Data Items SDK module](https://dev.wix.com/docs/sdk/backend-modules/data/items/introduction) for site development. While this module closely mirrors the Velo [`wix-data`](https://dev.wix.com/docs/velo/apis/wix-data/introduction) module, there are several functionality changes that might require modifications to your existing site code.

Learn more about [migrating from Velo to the SDK](https://dev.wix.com/docs/develop-websites/articles/coding-with-velo/develop-with-the-sdk/migrate-from-velo-to-the-sdk).

Below are important changes to be aware of when migrating to the Data Items SDK module:

## Permission elevation

When calling some methods of the Data Items SDK API, you might need to override permission checks. To do that, use [`elevate()`](https://dev.wix.com/docs/sdk/core-modules/essentials/auth#elevate). The Data Items SDK API doesn't support the `options.suppressAuth` parameter.

Learn more about [permission elevation when developing websites](https://dev.wix.com/docs/sdk/articles/work-with-the-sdk/about-elevated-permissions#elevation-when-developing-websites).

## aggregate()

The [`aggregate()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/aggregate) and [`WixDataAggregate`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-aggregate/introduction) methods can now return the total number of processed items.

When calling the `WixDataAggregate` method [`run()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-aggregate/run), set `options.returnTotalCount` to `true` to include the `totalCount` and `totalPages` properties in the aggregation result. For example:

```js
import { items } from "@wix/data";

const filter = items.filter().eq("year", 2010);

const result = await items
  .aggregate("PopulationData")
  .filter(filter)
  .max("population", "maxPopulation")
  .descending("maxPopulation")
  .run({ returnTotalCount: true });

const count = result.totalCount; // 17
const pages = result.totalPages; // 2
```

## bulkInsert()

The [`bulkInsert()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/bulk-insert) method now returns a full `WixDataBulkResult` object.

## bulkRemove()

The [`bulkRemove()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/bulk-remove) method now returns a full `WixDataBulkResult` object.

## bulkSave()

The [`bulkSave()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/bulk-save) method now returns a full `WixDataBulkResult` object.

## bulkUpdate()

The [`bulkUpdate()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/bulk-update) method now returns a full `WixDataBulkResult` object.

## insert()

The [`insert()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/insert) method no longer modifies the original object passed to it. For example:

```js
import { items } from "@wix/data";

const item = {
  title: "The Adventures of Huckleberry Finn",
  author: "Mark Twain",
};

const insertedItem = await items.insert("books", item);

// `insertedItem` contains properties generated by Wix.
// `item` remains unchanged.
```

> **Note**: The way Wix Data handles the item in the collection remains unchanged.

## query()

The [`query()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/query) and [`WixDataQuery`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-query/introduction) methods have been updated with the following changes:

### Total item count

Total item count is no longer returned by default. The `WixDataQuery` methods [`distinct()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-query/distinct) and [`find()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-query/find) no longer accept the `options.omitTotalCount` parameter. The query result only includes the `totalCount` and `totalPages` properties if `options.returnTotalCount` is set to `true`. For example:

```js
import { items } from "@wix/data";

const result = await items
  .query("myCollection")
  .find({ returnTotalCount: true });

const count = result.totalCount; // 17
const pages = result.totalPages; // 2
```

### WixDataQuery

Changes have been made to the parameters accepted by the following [`WixDataQuery`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-query/introduction) methods:

#### and()

The [`and()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-query/and) method now accepts a single [`WixDataFilter`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-filter/introduction) parameter.

#### include()

The [`include()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-query/include) method now accepts a query limit parameter. You can limit the number of query results you want to retrieve by specifying a field name and a query limit in the following format:

```js
function include(field: string, limit?: number): WixDataQuery;
```

For example:

```js
import { items } from "@wix/data";

const results = await items
  .query("myCollection")
  .include("referenceField", 10)
  .find();
```

#### not()

The [`not()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-query/not) method now accepts a single [`WixDataFilter`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-filter/introduction) parameter.

#### or()

The [`or()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-query/or) method now accepts a single [`WixDataFilter`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-filter/introduction) parameter.

### WixDataResult

The query result object [`WixDataResult`](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-result/introduction) no longer includes the [`query`](https://dev.wix.com/docs/velo/apis/wix-data/wix-data-query-result/query) and [`partialIncludes`](https://dev.wix.com/docs/velo/apis/wix-data/wix-data-query-result/partial-includes) properties.

## queryReferenced()

The [`queryReferenced()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/query-referenced) method includes the following changes:

### Total item count

Total item count is no longer returned by default. The [`queryReferenced()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/query-referenced) method no longer accepts the `options.omitTotalCount` parameter. Instead, the query result only includes the `totalCount` and `totalPages` properties if `options.returnTotalCount` is set to `true`. For example:

```js
import { items } from "@wix/data";

const result = await items.queryReferenced("movies", "00001", "actors", {
  returnTotalCount: true,
});

const count = result.totalCount; // 17
const pages = result.totalPages; // 2
```

## save()

The [`save()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/save) method no longer modifies the original object passed to it. For example:

```js
import { items } from "@wix/data";

const item = {
  title: "The Adventures of Huckleberry Finn",
  author: "Mark Twain",
};

const insertedItem = await items.save("books", item);

// `insertedItem` contains properties generated by Wix.
// `item` remains unchanged.
```

> **Note**: The way Wix Data handles the item in the collection remains unchanged.

## update()

The [`update()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/update) method no longer modifies the original object passed to it. For example:

```js
import { items } from "@wix/data";

const item = {
  _id: "0001",
  title: "The Adventures of Huckleberry Finn",
  author: "Mark Twain",
};

const insertedItem = await items.update("books", item);

// `insertedItem` contains properties generated by Wix.
// `item` remains unchanged.
```

> **Note**: The way Wix Data handles the item in the collection remains unchanged.

## Wix Data errors

Wix Data errors include the following changes:

### Errors are standardized

Wix Data errors now follow the standardized error format.

Learn more about [errors](https://dev.wix.com/docs/sdk/articles/work-with-the-sdk/about-errors) in Wix APIs.

### Validation errors specify violating fields

[Filter validation error messages](https://dev.wix.com/docs/sdk/articles/work-with-the-sdk/about-errors#validation-error-data) now indicate the violating field in the following format:

```console
{fieldPath}.{operator} should be a Date, number, or string. Got {value} instead.
```

The following Wix Data errors have the updated format:

- WDE0056
- WDE0057
- WDE0058
- WDE0059
- WDE0060

Learn more about [Wix Data error codes](https://dev.wix.com/docs/sdk/backend-modules/data/wix-data-error-codes).
