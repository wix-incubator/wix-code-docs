{ "name": "wix-events",
  "mixes": [],
  "labels":
    [ "changed" ],
  "location":
    { "lineno": 1,
      "filename": "index.js" },
  "docs":
    { "summary": "The wix-events module contains functionality for working with\n Wix Events from client-side code.",
      "description":
        [ "Before working with the Events API, you need to ",
          " [install the Wix Events app](https://support.wix.com/en/article/adding-wix-events-to-your-site) and",
          " [create at least one event](https://support.wix.com/en/article/creating-an-event-in-wix-events).",
          "",
          " You can use the Wix Event API to [create a custom RSVP form](wix-events/rsvp-obj/introduction#typical-custom-rsvp-lifecycle)",
          " and to [offer tickets](wix-events.Tickets.html#ticketing-lifecycle) for your events.",
          "",
          " To use the Wix Events API, import `wixEvents` from the `wix-events` module:",
          "",
          "   ```javascript",
          "   import wixEvents from 'wix-events';",
          "   ```",
          "",
          "> **Note:**",
          " To work with the Wix Events API, you need to publish your site." ],
      "links": [],
      "examples": [],
      "extra":
        {  } },
  "properties":
    [ { "name": "rsvp",
        "labels":
          [ "changed" ],
        "get": true,
        "set": false,
        "type": "wix-events.Rsvp",
        "locations":
          [ { "lineno": 44,
              "filename": "index.js" } ],
        "docs":
          { "summary": "Gets an object containing RSVP functionality.",
            "description":
              [ "Use the `RSVP` object to create an RSVP for an event.",
                "> **Note:**",
                " To work with the Wix Events API, you need to publish your site." ],
            "links": [],
            "examples":
              [ { "title": "Create and submit a registration form",
                  "body":
                    [ "import wixEvents from 'wix-events';",
                      "import wixData from 'wix-data';",
                      "",
                      "$w.onReady(function () {  ",
                      "  let eventId;",
                      "",
                      "  // Run a query that will return only one event. Add",
                      "  // additional filtering to the query if necessary.",
                      "  wixData.query(\"Events/Events\")",
                      "    .eq(\"title\", \"My Event\")",
                      "    .find()",
                      "    .then( (results) => {",
                      "      if(results.items.length > 0) {",
                      "        eventId = results.items[0]._id;",
                      "      }",
                      "      else {",
                      "        console.log(\"Could not find event\");",
                      "      }",
                      "    });",
                      "  ",
                      "  $w(\"#submit\").onClick( () => {",
                      "    const formValues = getFormValues();",
                      "",
                      "    wixEvents.rsvp.createRsvp(eventId, formValues)",
                      "      .then( (result) => {",
                      "        console.log(\"RSVP created.\")",
                      "      } )",
                      "      .catch( (error) => {",
                      "        console.log(`Error message: ${error.message}`);",
                      "        if(error.fields) {",
                      "          console.log(`Incorrect fields: ${error.fields}`);\t",
                      "        }",
                      "      } );\t",
                      "  } );",
                      "});",
                      "",
                      "function getFormValues() {",
                      "  return [",
                      "    {\"name\": \"rsvpStatus\", \"value\": \"YES\"},",
                      "    {\"name\": \"firstName\", \"value\": $w(\"#firstName\").value},",
                      "    {\"name\": \"lastName\", \"value\": $w(\"#lastName\").value},",
                      "    {\"name\": \"email\", \"value\": $w(\"#email\").value},",
                      "    {\"name\": \"custom\", \"value\": $w(\"#foodAllergies\").value},",
                      "",
                      "    // When a form contains an address, the way you format the",
                      "    // address information for submission depends on what type",
                      "    // of input elements you use to gather that information.",
                      "",
                      "    // Wix address input element.",
                      "    {\"name\": \"address\", \"value\": $w(\"#address\").value},",
                      "",
                      "    // Single element which is not an address",
                      "    // input element, such as a text input.",
                      "    {\"name\": \"address\", \"value\": [$w(\"#address\").value]},",
                      "",
                      "    // Multiple elements for the",
                      "    // various parts of an address.",
                      "    {",
                      "      \"name\": \"address\", ",
                      "      \"value\": [",
                      "        $w(\"#street\").value,",
                      "        $w(\"#city\").value,",
                      "        $w(\"#state\").value,",
                      "        $w(\"#country\").value,",
                      "        $w(\"#postalCode\").value",
                      "      ]",
                      "    },",
                      "",
                      "    // When a form contains an input for adding more guests to an",
                      "    // RSVP, format the guest names for submission in an array",
                      "    // where each element is the full name of a guest.",
                      "    {\"name\": \"additionalGuests\", \"value\": $w('#additionalGuests').value},",
                      "    {",
                      "      \"name\": \"guestNames\",",
                      "      \"value\": [",
                      "        `${$w(\"#guest1FirstName\").value} ${$w(\"#guest1LastName\").value}`,",
                      "        `${$w(\"#guest2FirstName\").value} ${$w(\"#guest2LastName\").value}`,",
                      "      ]",
                      "    }",
                      "  ];",
                      "}" ],
                  "extra":
                    {  } } ],
            "extra":
              {  } },
        "extra":
          {  } },
      { "name": "tickets",
        "labels": [],
        "get": true,
        "set": false,
        "type": "wix-events.Tickets",
        "locations":
          [ { "lineno": 57,
              "filename": "index.js" } ],
        "docs":
          { "summary": "Gets an object containing ticketing functionality.",
            "description":
              [ "Use the `Tickets` object to reserve and checkout tickets for an event.",
                "> **Note:**",
                " To work with the Wix Events API, you need to publish your site." ],
            "links": [],
            "examples":
              [ { "title": "Reserve, checkout, and update tickets",
                  "body":
                    [ "import wixEvents from 'wix-events';",
                      "import wixData from 'wix-data';",
                      "import wixPay from 'wix-pay';",
                      "",
                      "let eventId;",
                      "let reservationId;",
                      "let orderNumber;",
                      "let tickets;",
                      "",
                      "$w.onReady(function () {",
                      "  // Retrieve data and set up page",
                      "  await getData();",
                      "  $w(\"#ticketRepeater\").onItemReady(displayTickets);",
                      "  $w(\"#ticketRepeater\").data = tickets;",
                      "",
                      "  // Define button click actions",
                      "  $w(\"reservationButton\").onClick(reserveTickets);",
                      "  $w(\"checkoutButton\").onClick(checkoutTickets);",
                      "  $w(\"updateButton\").onClick(updateTickets);",
                      "",
                      "  // Verify coupon code when it is entered",
                      "  $w(\"#couponCode\").onCustomValidation(verifyCouponCode);",
                      "});",
                      "",
                      "async function getData() {",
                      "  // Run a query that will return only one event. Add",
                      "  // additional filtering to the query if necessary.",
                      "  const eventResults = await wixData.query(\"Events/Events\")",
                      "    .eq(\"title\", \"My Event\")",
                      "    .find();",
                      "",
                      "  if (eventResults.items.length > 0) {",
                      "    eventId = eventResults.items[0]._id;",
                      "",
                      "    // Get tickets for the event",
                      "    const ticketResults = await wixData.query(\"Events/Tickets\")",
                      "      .eq(\"event\", eventId)",
                      "      .find();",
                      "",
                      "      if (ticketResults.items.length > 0) {",
                      "        tickets = ticketResults.items;",
                      "      }",
                      "      else {",
                      "        $w(\"#ticketRepeater\").hide();",
                      "        console.log(\"Could not find tickets\");",
                      "      }",
                      "  } ",
                      "  else {",
                      "    console.log(\"Could not find event\");",
                      "  }",
                      "}",
                      "",
                      "function displayTickets($item, itemData, index) {",
                      "  $item(\"#ticketName\").text = itemData.name;",
                      "  $item(\"#ticketPrice\").text = itemData.price.toString();",
                      "  $item(\"#ticketQuantity\").value = 0;",
                      "}",
                      "",
                      "function reserveTickets() {",
                      "  const selectedTickets = getSelectedTickets();",
                      "",
                      "  wixEvents.tickets.reserve(eventId, selectedTickets)",
                      "    .then( (reservation) => {",
                      "      reservationId = reservation.id;",
                      "    } )",
                      "    .catch( (error) => {",
                      "      console.log(\"Error\", error.message)",
                      "    } );",
                      "}",
                      "",
                      "function getSelectedTickets() {",
                      "  let selectedTickets = [];",
                      "",
                      "  $w(\"#ticketRepeater\").forEachItem( ($item, itemData, index) => {",
                      "    if($item(\"#ticketQuantity\").value > 0) {",
                      "      selectedTickets.push( {",
                      "        \"ticketId\": itemData._id,",
                      "        \"quantity\": $item(\"#ticketQuantity\").value",
                      "      } );",
                      "    }",
                      "  } );",
                      "",
                      "  return selectedTickets;",
                      "}",
                      "",
                      "function checkoutTickets() {",
                      "  wixEvents.tickets.checkout(eventId, reservationId, {",
                      "    \"formValues\": getFormValues(),",
                      "    \"coupon\": $w(\"#couponCode\").value",
                      "  })",
                      "    .then( ({order}) => {",
                      "      orderNumber = order.orderNumber",
                      "      wixPay.startPayment(order.paymentId);",
                      "      // Note that PDF tickets are available before payment is complete",
                      "      $w(\"ticketsPdfLink\").value = order.ticketsPdf;",
                      "    })",
                      "    .catch( (error) => {",
                      "      console.log(\"Error\", error.message)",
                      "    } );",
                      "}",
                      "",
                      "function updateTickets() {",
                      "  wixEvents.tickets.updateOrder(eventId, orderNumber, {",
                      "    \"formValues\": getFormValues()",
                      "  })",
                      "    .catch( (error) => {",
                      "      console.log(\"Error\", error.message)",
                      "    } );",
                      "}",
                      "",
                      "function verifyCouponCode(value, reject) {",
                      "  const coupon = $w(\"#couponCode\").value;",
                      "  wixEvents.tickets.verifyCoupon(eventId, reservationId, coupon) ",
                      "    .then( (result) => {",
                      "      if (result.discountErrors) {",
                      "        // handle verification failure",
                      "        $w(\"#couponCode\").updateValidityIndication();",
                      "        $w(\"#couponErrorMsg\").show();",
                      "        $w(\"#couponSuccessMsg\").hide();",
                      "        reject(\"Coupon is invalid\");",
                      "      } ",
                      "      else {",
                      "        // handle coupon verified",
                      "        $w(\"#couponErrorMsg\").hide()",
                      "        $w(\"#couponSuccessMsg\").show()",
                      "      }",
                      "    } );",
                      "}",
                      "",
                      "function getFormValues() {",
                      "  return [",
                      "    {\"name\": \"firstName\", \"value\": $w(\"#firstName\").value},",
                      "    {\"name\": \"lastName\", \"value\": $w(\"#lastName\").value},",
                      "    {\"name\": \"email\", \"value\": $w(\"#email\").value},",
                      "    {\"name\": \"custom\", \"value\": $w(\"#foodAllergies\").value},",
                      "",
                      "    // When a form contains an address, the way you format the",
                      "    // address information for submission depends on what type",
                      "    // of input elements you use to gather that information.",
                      "",
                      "    // Wix address input element.",
                      "    {\"name\": \"address\", \"value\": $w(\"#address\").value},",
                      "",
                      "    // Single element which is not an address",
                      "    // input element, such as a text input.",
                      "    {\"name\": \"address\", \"value\": [$w(\"#address\").value]},",
                      "",
                      "    // Multiple elements for the",
                      "    // various parts of an address.",
                      "    {",
                      "      \"name\": \"address\", ",
                      "      \"value\": [",
                      "        $w(\"#street\").value,",
                      "        $w(\"#city\").value,",
                      "        $w(\"#state\").value,",
                      "        $w(\"#country\").value,",
                      "        $w(\"#postalCode\").value",
                      "      ]",
                      "    },",
                      "",
                      "    // When a form contains an input for adding more guests to an",
                      "    // RSVP, format the guest names for submission in an array",
                      "    // where each element is the full name of a guest.",
                      "    {\"name\": \"additionalGuests\", \"value\": $w(\"#additionalGuests\").value},",
                      "    {",
                      "      \"name\": \"guestNames\",",
                      "      \"value\": [",
                      "        `${$w(\"#guest1FirstName\").value} ${$w(\"#guest1LastName\").value}`,",
                      "        `${$w(\"#guest2FirstName\").value} ${$w(\"#guest2LastName\").value}`,",
                      "      ]",
                      "    }",
                      "  ];",
                      "}" ],
                  "extra":
                    {  } } ],
            "extra":
              {  } },
        "extra":
          {  } } ],
  "operations":
    [ { "name": "createEventRsvpForm",
        "labels":
          [ "changed" ],
        "nameParams": [],
        "params":
          [ { "name": "eventId",
              "type": "string",
              "doc": "ID of the event to create an RSVP form for." } ],
        "ret":
          { "type": "wix-events.RsvpForm",
            "doc": "An RSVP form object." },
        "locations":
          [ { "lineno": 1,
              "filename": "rsvpForm.js" } ],
        "docs":
          { "summary": "**Deprecated:** Creates a new RSVP form for the specified event.",
            "description":
              [ "**Deprecation note:** The `createEventRsvpForm()` function is being deprecated. Use",
                " the [`getForm()`](#getForm) function instead.",
                "",
                " Use the `createEventRsvpForm()` function to retrieve the information",
                " you need to [create a custom RSVP form](wix-events/rsvpform/introduction#typical-custom-rsvp-form-lifecycle)",
                " for a specified event and to submit the form data to register guests for the event.",
                "",
                " Retrieve event IDs to specify an event from the **Events/Events** collection.",
                "> **Note:**",
                " To work with the Wix Events API, you need to publish your site." ],
            "links": [],
            "examples":
              [ { "title": "Create an RSVP form",
                  "body":
                    [ "import wixEvents from 'wix-events';",
                      "",
                      "// ...",
                      "",
                      "const eventId = // get an event ID",
                      "",
                      "const eventRsvpForm = wixEvents.createEventRsvpForm(eventId);" ],
                  "extra":
                    {  } },
                { "title": "Create and submit an RSVP form",
                  "body":
                    [ "import wixEvents from 'wix-events';",
                      "import wixData from 'wix-data';",
                      "",
                      "$w.onReady(function () {",
                      "  let form;",
                      "",
                      "  // Run a query that will return only one event. Add",
                      "  // additional filtering to the query if necessary.",
                      "  wixData.query(\"Events/Events\")",
                      "    .eq(\"title\", \"My Event\")",
                      "    .find()",
                      "    .then( (results) => {",
                      "      if(results.items.length > 0) {",
                      "        form = wixEvents.createEventRsvpForm(results.items[0]._id);",
                      "      }",
                      "      else {",
                      "        console.log(\"Could not find event\");",
                      "      }",
                      "    });",
                      "  ",
                      "  $w(\"#submit\").onClick( () => {",
                      "    const formValues = getFormValues();",
                      "",
                      "    form.submit(formValues)",
                      "      .then( (result) => {",
                      "        console.log(\"RSVP form submitted.\")",
                      "      } )",
                      "      .catch( (error) => {",
                      "        console.log(`Error message: ${error.message}`);",
                      "        if(error.fields) {",
                      "          console.log(`Incorrect fields: ${error.fields}`);\t",
                      "        }",
                      "      } );\t",
                      "  } );",
                      "});",
                      "",
                      "function getFormValues() {",
                      "  return [",
                      "    {\"name\": \"rsvpStatus\", \"value\": \"YES\"},",
                      "    {\"name\": \"firstName\", \"value\": $w(\"#firstName\").value},",
                      "    {\"name\": \"lastName\", \"value\": $w(\"#lastName\").value},",
                      "    {\"name\": \"email\", \"value\": $w(\"#email\").value},",
                      "    {\"name\": \"custom\", \"value\": $w(\"#foodAllergies\").value},",
                      "",
                      "    // When a form contains an address, the way you format the",
                      "    // address information for submission depends on what type",
                      "    // of input elements you use to gather that information.",
                      "",
                      "    // Wix address input element.",
                      "    {\"name\": \"address\", \"value\": $w(\"#address\").value},",
                      "",
                      "    // Single element which is not an address",
                      "    // input element, such as a text input.",
                      "    {\"name\": \"address\", \"value\": [$w(\"#address\").value]},",
                      "",
                      "    // Multiple elements for the",
                      "    // various parts of an address.",
                      "    {",
                      "      \"name\": \"address\", ",
                      "      \"value\": [",
                      "        $w(\"#street\").value,",
                      "        $w(\"#city\").value,",
                      "        $w(\"#state\").value,",
                      "        $w(\"#country\").value,",
                      "        $w(\"#postalCode\").value",
                      "      ]",
                      "    },",
                      "",
                      "    // When a form contains an input for adding more guests to an",
                      "    // RSVP, format the guest names for submission in an array",
                      "    // where each element is the full name of a guest.",
                      "    {\"name\": \"additionalGuests\", \"value\": $w('#additionalGuests').value},",
                      "    {",
                      "      \"name\": \"guestNames\",",
                      "      \"value\": [",
                      "        `${$w(\"#guest1FirstName\").value} ${$w(\"#guest1LastName\").value}`,",
                      "        `${$w(\"#guest2FirstName\").value} ${$w(\"#guest2LastName\").value}`,",
                      "      ]",
                      "    }",
                      "  ];",
                      "}" ],
                  "extra":
                    {  } } ],
            "extra":
              {  } },
        "extra":
          {  } },
      { "name": "getForm",
        "labels":
          [ "changed" ],
        "nameParams": [],
        "params":
          [ { "name": "eventId",
              "type": "string",
              "doc": "ID of the event to get a registration form for." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "wix-events.Form" ] },
            "doc": "Fulfilled - A registration form object for the specified event." },
        "locations":
          [ { "lineno": 25,
              "filename": "index.js" } ],
        "docs":
          { "summary": "Gets a new registration form for the specified event.",
            "description":
              [ "Use the `getForm()` function to retrieve the information",
                " you need to [create a custom registration form](wix-events/form) ",
                " for a specified event.",
                "",
                " Retrieve event IDs from the **Events/Events** collection to specify which event's form to get.",
                "> **Note:**",
                " To work with the Wix Events API, you need to publish your site." ],
            "links": [],
            "examples":
              [ { "title": "Gets \ban registration form",
                  "body":
                    [ "import wixEvents from 'wix-events';",
                      "",
                      "// ...",
                      "",
                      "const eventId = // get an event ID",
                      "",
                      "wixEvents.getForm(eventId)",
                      "  .then( (result) => {",
                      "    let form = result;",
                      "  } );" ],
                  "extra":
                    {  } },
                { "title": "Get and submit a registration form",
                  "body":
                    [ "import wixEvents from 'wix-events';",
                      "import wixData from 'wix-data';",
                      "",
                      "$w.onReady(function () {  ",
                      "  let eventId;",
                      "",
                      "  // Run a query that will return only one event. Add",
                      "  // additional filtering to the query if necessary.",
                      "  wixData.query(\"Events/Events\")",
                      "    .eq(\"title\", \"My Event\")",
                      "    .find()",
                      "    .then( (results) => {",
                      "      if(results.items.length > 0) {",
                      "        eventId = results.items[0]._id;",
                      "      }",
                      "      else {",
                      "        console.log(\"Could not find event\");",
                      "      }",
                      "    });",
                      "  ",
                      "  $w(\"#submit\").onClick( () => {",
                      "    const formValues = getFormValues();",
                      "",
                      "    wixEvents.rsvp.createRsvp(eventId, formValues)",
                      "      .then( (result) => {",
                      "        console.log(\"RSVP created.\")",
                      "      } )",
                      "      .catch( (error) => {",
                      "        console.log(`Error message: ${error.message}`);",
                      "        if(error.fields) {",
                      "          console.log(`Incorrect fields: ${error.fields}`);\t",
                      "        }",
                      "      } );\t",
                      "  } );",
                      "});",
                      "",
                      "function getFormValues() {",
                      "  return [",
                      "    {\"name\": \"rsvpStatus\", \"value\": \"YES\"},",
                      "    {\"name\": \"firstName\", \"value\": $w(\"#firstName\").value},",
                      "    {\"name\": \"lastName\", \"value\": $w(\"#lastName\").value},",
                      "    {\"name\": \"email\", \"value\": $w(\"#email\").value},",
                      "    {\"name\": \"custom\", \"value\": $w(\"#foodAllergies\").value},",
                      "",
                      "    // When a form contains an address, the way you format the",
                      "    // address information for submission depends on what type",
                      "    // of input elements you use to gather that information.",
                      "",
                      "    // Wix address input element.",
                      "    {\"name\": \"address\", \"value\": $w(\"#address\").value},",
                      "",
                      "    // Single element which is not an address",
                      "    // input element, such as a text input.",
                      "    {\"name\": \"address\", \"value\": [$w(\"#address\").value]},",
                      "",
                      "    // Multiple elements for the",
                      "    // various parts of an address.",
                      "    {",
                      "      \"name\": \"address\", ",
                      "      \"value\": [",
                      "        $w(\"#street\").value,",
                      "        $w(\"#city\").value,",
                      "        $w(\"#state\").value,",
                      "        $w(\"#country\").value,",
                      "        $w(\"#postalCode\").value",
                      "      ]",
                      "    },",
                      "",
                      "    // When a form contains an input for adding more guests to an",
                      "    // RSVP, format the guest names for submission in an array",
                      "    // where each element is the full name of a guest.",
                      "    {\"name\": \"additionalGuests\", \"value\": $w('#additionalGuests').value},",
                      "    {",
                      "      \"name\": \"guestNames\",",
                      "      \"value\": [",
                      "        `${$w(\"#guest1FirstName\").value} ${$w(\"#guest1LastName\").value}`,",
                      "        `${$w(\"#guest2FirstName\").value} ${$w(\"#guest2LastName\").value}`,",
                      "      ]",
                      "    }",
                      "  ];",
                      "}" ],
                  "extra":
                    {  } } ],
            "extra":
              {  } },
        "extra":
          {  } } ],
  "callbacks": [],
  "messages": [],
  "extra":
    { "scopes":
        [ "frontend" ] } }