{ "name": "bookings-custom-pricing",
  "mixes": [],
  "labels":
    [ "changed" ],
  "location":
    { "lineno": 1,
      "filename": "custom-pricing-index.js" },
  "docs":
    { "summary": "The Bookings Custom Pricing SPI.",
      "description":
        [ "The Custom Pricing SPI is a service provider interface that allows site owners and collaborators to add custom pricing ",
          "to bookings on their site. The custom pricing is calculated and used as the basis for the price",
          "when checking out the booking, overriding the standard Bookings pricing logic.",
          "",
          "Wix Bookings calls the SPI endpoint [`calculatePrice()`](https://www.wix.com/velo/reference/bookings-custom-pricing/calculatePrice) ",
          "to retrieve the relevant data for a site collaborator to customize the price. ",
          "Collaborators can then implement their own logic to calculate and return the price. ",
          "",
          "Note that the `currency` used by [`calculatePrice()`](https://www.wix.com/velo/reference/bookings-custom-pricing/calculatePrice)",
          "is your site's currency. You can find the currency of your site using the [`getPaymentCurrency()`](https://www.wix.com/velo/reference/wix-site-backend/generalinfo-obj/getpaymentcurrency)",
          "function. ",
          "",
          "Learn more about the [Bookings Custom Pricing SPI custom extension](https://support.wix.com/en/article/velo-tutorial-bookings-pricing-custom-extension)." ],
      "links": [],
      "examples": [],
      "extra":
        {  } },
  "properties": [],
  "operations":
    [ { "name": "calculatePrice",
        "labels": [],
        "nameParams": [],
        "params":
          [ { "name": "options",
              "type": "bookings-custom-pricing.Options",
              "doc": "Options for line items and shipping options." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "bookings-custom-pricing.CalculatePriceResponse" ] },
            "doc": "Fulfilled - Additional fees and currency info." },
        "locations":
          [ { "lineno": 191,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "summary": "Calculates the price of a booking to include during checkout. The calculated price is based on custom business logic.",
            "description":
              [ "The `calculatePrice()` function calculates custom pricing checkout pages of a merchant's site.",
                "The function is automatically called by Wix Bookings when the booking price is calculated." ],
            "links": [],
            "examples":
              [ { "title": "Calculate a custom price for a booking",
                  "body":
                    [ "import wixSiteBackend from 'wix-site-backend';",
                      "",
                      "// TBD --- THIS IS A PLACEHOLDER FOR NOW",
                      "",
                      "export const calculatePrice = async (options) => {",
                      "  let additionalFees = [];",
                      "  const feePrice = calculateWrappingFee(options.lineItems);",
                      "  const currency = await wixSiteBackend.generalInfo.getPaymentCurrency();",
                      "",
                      "  if (feePrice) {",
                      "    additionalFees.push({",
                      "      code: 'fragile-packaging',",
                      "      name: 'Fragile Packaging',",
                      "      price: String(feePrice),",
                      "      taxDetails: {",
                      "        taxable: true",
                      "      }",
                      "    });",
                      "  }",
                      "",
                      "  return {",
                      "    currency,",
                      "    additionalFees",
                      "  };",
                      "};",
                      "",
                      "// Check if an item is fragile.",
                      "function isFragile(item) {",
                      "  const productName = item.productName.toLowerCase();",
                      "  return productName.includes('glass') || productName.includes('ceramic');",
                      "}",
                      "",
                      "// Charge per fragile item.",
                      "// Give away free packaging when ordering at least 5 items.",
                      "function calculateWrappingFee(lineItems) {",
                      "  const minItemsForFreeWrapping = 5;",
                      "  let numFragileItems = 0;",
                      "  lineItems.forEach((item) => {",
                      "    if (isFragile(item)){",
                      "      numFragileItems += item.quantity;",
                      "    }",
                      "  });",
                      "  const shouldChargeFee = numFragileItems < minItemsForFreeWrapping;",
                      "  const price = shouldChargeFee ? numFragileItems : 0;",
                      "  return price;",
                      "}",
                      "" ],
                  "extra":
                    { "description": "This example calculates the custom price for booking a massage using cheaper rates for weekdays and with additional options." } } ],
            "extra":
              {  } },
        "extra":
          {  } } ],
  "callbacks": [],
  "messages":
    [ { "name": "BookedEntity",
        "locations":
          [ { "lineno": 64,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "An object describing the slot or schedule that was booked." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "slot",
              "type": "bookings-custom-pricing.Slot",
              "doc": "The booked slot, once booked becomes a session, The booking is automatically assigned to the session if it already exists, or creates a session if one doesn't already exist.",
              "optional": true },
            { "name": "schedule",
              "type": "bookings-custom-pricing.Schedule",
              "doc": "The booked schedule. The booking is automatically assigned to the schedule's sessions.",
              "optional": true },
            { "name": "title",
              "type": "string",
              "doc": "Session title at the time of booking." },
            { "name": "tags",
              "type":
                { "name": "Array",
                  "typeParams":
                    [ "string" ] },
              "doc": "List of tags for the booking.\nSystem-assigned tags for sessions and schedules are:\n\n+ `\"INDIVIDUAL\"` Appointments, including appointments with more than 1 participant.\n+ `\"GROUP\"` Individual classes.\n+ `\"COURSE\"` Courses." } ],
        "extra":
          { "oneOfGroups":
              [ { "name": "entityType",
                  "members":
                    [ "slot",
                      "schedule" ] } ] },
        "labels":
          [ "new" ] },
      { "name": "Booking",
        "locations":
          [ { "lineno": 140,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "The booking to calculate the price of." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "namespace",
              "type": "object",
              "doc": "Data extensions extended fields in `key:value` pairs. \n+ `key`: Namespace.\n+ `value`: Extended fields data in `Struct` format." },
            { "name": "_createdDate",
              "type": "date",
              "doc": "Date and time the booking was created." },
            { "name": "_updatedDate",
              "type": "date",
              "doc": "Date and time the booking was updated." },
            { "name": "additionalFields",
              "type":
                { "name": "Array",
                  "typeParams":
                    [ "bookings-custom-pricing.CustomFormField" ] },
              "doc": "Additional custom fields submitted with the booking form." },
            { "name": "bookedEntity",
              "type": "bookings-custom-pricing.BookedEntity",
              "doc": "An object describing the slot or schedule that was booked." },
            { "name": "contactDetails",
              "type": "bookings-custom-pricing.ContactDetails",
              "doc": "Contact details of the site visitor or member making the booking." },
            { "name": "startDate",
              "type": "string",
              "doc": "The start date of this booking in [RFC 3339](https://www.rfc-editor.org/rfc/rfc3339) format.  For a slot, this is the start date of the slot. For a schedule, this is the start date of the first session." },
            { "name": "endDate",
              "type": "string",
              "doc": "The end date of this booking in [RFC 3339](https://www.rfc-editor.org/rfc/rfc3339) format.  For a slot, this is the end date of the slot. For a schedule, this is the end date of the last session." },
            { "name": "createdBy",
              "type": "bookings-custom-pricing.CreatedBy",
              "doc": "ID of the creator of the booking. If `appId` and another ID are present, the other ID takes precedence." },
            { "name": "doubleBooked",
              "type": "boolean",
              "doc": "Whether this booking overlaps another existing confirmed booking." },
            { "name": "extendedFields",
              "type": "bookings-custom-pricing.ExtendedFields",
              "doc": "Additional custom fields. This includes fields managed by Wix, by 3rd-party apps, and by the site." },
            { "name": "externalUserId",
              "type": "string",
              "doc": "External ID provided by the client app on creation." },
            { "name": "paymentStatus",
              "type": "string",
              "doc": "Payment status. One of: \n+ `\"NOT_PAID\"` The booking is not paid for.\n+ `\"PAID\"` The booking is fully paid.\n+ `\"PARTIALLY_PAID\"` The booking is partially paid.\n+ `\"REFUNDED\"` The booking is refunded." },
            { "name": "revision",
              "type": "string",
              "doc": "Revision number to be used when updating, rescheduling, or cancelling the booking. Revision number, which increments by 1 each time the booking is updated, rescheduled, or canceled. To prevent conflicting changes,the current revision must be passed when updating the booking." },
            { "name": "selectedPaymentOption",
              "type": "string",
              "doc": "Selected payment option. One of the payment options offered by the service, or another option if `skipSelectedPaymentOptionValidation` is `true`. When undefined, the payment option is resolved by the service configuration on checkout." },
            { "name": "status",
              "type": "string",
              "doc": "Booking status. One of:\n+ `\"CREATED\"`. A potential booking was created but not yet confirmed.\n+ `\"UPDATED\"`. The booking was updated.\n+ `\"CONFIRMED\"`. The booking has been confirmed and appears on the calendar.\n+ `\"CANCELED\"`. The booking has been canceled and the cancelation is synced to the calendar.\n+ `\"PENDING\"`. The booking is waiting to be confirmed or declined by the owner. In the meantime, th booking is synced to the calendar.\n+ `\"WAITING_LIST\"`. The booking is on a waiting list.\n+ `\"DECLINED\"`. The booking was declined by the owner and the decline is synced to the calendar." },
            { "name": "totalParticipants",
              "type": "number",
              "doc": "Total number of participants. Available only when the booking includes a single service variant.",
              "optional": true },
            { "name": "participantsChoices",
              "type": "bookings-custom-pricing.ParticipantsChoices",
              "doc": "Information about the booked service choices and participants. Available only when the booking includes multiple service variants.",
              "optional": true } ],
        "extra":
          { "oneOfGroups":
              [ { "name": "participants",
                  "members":
                    [ "totalParticipants",
                      "participantsChoices" ] } ] },
        "labels":
          [ "changed" ] },
      { "name": "CalculatePriceResponse",
        "locations":
          [ { "lineno": 183,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "totalPrice",
              "type": "number",
              "doc": "The price for the booking according to your custom logic.\n\nThe `calculatedPrice` response is based on your site's currency." } ],
        "extra":
          {  },
        "labels":
          [ "changed" ] },
      { "name": "Choice",
        "locations":
          [ { "lineno": 114,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "Service choices for these participants." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "optionId",
              "type": "string",
              "doc": "ID of the corresponding option for the choice. For example, the choice `child` could correspond to the option `ageGroup`. In this case, `optionId` is the ID for the `ageGroup` option." },
            { "name": "custom",
              "type": "string",
              "doc": "Value for one of the choices in the CustomServiceOption.choices list. Choices are specific values for an option the customer can choose to book. For example, the option `ageGroup` may have these choices: `child`, `student`, `adult`, and `senior`. Each choice may have a different price.",
              "optional": true } ],
        "extra":
          { "oneOfGroups":
              [ { "name": "choiceType",
                  "members":
                    [ "custom" ] } ] },
        "labels":
          [ "new" ] },
      { "name": "CommonIdentificationData",
        "locations":
          [ { "lineno": 93,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "ID of the creator of the booking. If `appId` and another ID are present, the other ID takes precedence." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "contactId",
              "type": "string",
              "doc": "ID of of a contact in the site's CRM system." },
            { "name": "anonymousVisitorId",
              "type": "string",
              "doc": "ID of a site visitor that has not logged in to the site." },
            { "name": "appId",
              "type": "string",
              "doc": "ID of an app." },
            { "name": "memberId",
              "type": "string",
              "doc": "ID of a site visitor that has logged in to the site." },
            { "name": "wixUserId",
              "type": "string",
              "doc": "ID of a Wix user (site owner, contributor, etc.)." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "ContactDetails",
        "locations":
          [ { "lineno": 51,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "Contact details of the site visitor or member making the booking." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "contactID",
              "type": "string",
              "doc": "Contact's ID." },
            { "name": "firstName",
              "type": "string",
              "doc": "Contact's first name. When populated from a standard booking form, this property corresponds to the `Name` field." },
            { "name": "lastName",
              "type": "string",
              "doc": "Contact's last name." },
            { "name": "email",
              "type": "string",
              "doc": "Contact's email, used to create a new contact or get existing one from the [Contacts API](https://www.wix.com/velo/reference/wix-crm). Used to validate coupon usage limitations per contact. If not passed, the coupon usage limitation will not be enforced. (Coupon usage limitation validation is not supported yet)." },
            { "name": "phone",
              "type": "string",
              "doc": "Contact's phone number." },
            { "name": "fullAddress",
              "type": "bookings-custom-pricing.FullAddress",
              "doc": "Contact's full address." },
            { "name": "countryCode",
              "type": "string",
              "doc": "Contact's country in [ISO 3166-1 alpha-2 code](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2) format." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "CustomFormField",
        "locations":
          [ { "lineno": 81,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "Additional custom field submitted with the booking form." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "_id",
              "type": "string",
              "doc": "ID of the form field as defined in the form." },
            { "name": "label",
              "type": "string",
              "doc": "Form field's label at the time of submission." },
            { "name": "value",
              "type": "string",
              "doc": "Value that was submitted for this field." },
            { "name": "valueType",
              "type": "string",
              "doc": "One of: \n+ `\"SHORT_TEXT\"`\n+ `\"LONG_TEXT\"`\n+ `\"CHECK_BOX\"`" } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "ExtendedFields",
        "locations":
          [ { "lineno": 103,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "Additional custom fields. This includes fields managed by Wix, by 3rd-party apps, and by the site." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "contactId",
              "type": "string",
              "doc": "ID of of a contact in the site's CRM system." },
            { "name": "anonymousVisitorId",
              "type": "string",
              "doc": "ID of a site visitor that has not logged in to the site." },
            { "name": "appId",
              "type": "string",
              "doc": "ID of an app." },
            { "name": "memberId",
              "type": "string",
              "doc": "ID of a site visitor that has logged in to the site." },
            { "name": "wixUserId",
              "type": "string",
              "doc": "ID of a Wix user (site owner, contributor, etc.)." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "Location",
        "locations":
          [ { "lineno": 12,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "Location where the slot's session takes place." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "_id",
              "type": "string",
              "doc": "Business location ID. Available only for locations that are business locations, meaning the location_type is `\"OWNER_BUSINESS\"`." },
            { "name": "name",
              "type": "string",
              "doc": "Location name." },
            { "name": "formattedAddress",
              "type": "string",
              "doc": "The full address of this location." },
            { "name": "locationType",
              "type": "string",
              "doc": "Resource's schedule ID.Supported values: `\"OWNER_BUSINESS\"`, `\"OWNER_CUSTOM\"`, `\"CUSTOM\"`.\nLocation type.\n+ `\"OWNER_BUSINESS\"`: The business address, as set in the siteâ€™s general settings.\n+ `\"OWNER_CUSTOM\"`: The address as set when creating the service.\n+ `\"CUSTOM\"`: The address as set for the individual session." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "Options",
        "locations":
          [ { "lineno": 178,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "booking",
              "type": "bookings-custom-pricing.Booking",
              "doc": "Booking to calculate custom pricing for." } ],
        "extra":
          {  },
        "labels": [] },
      { "name": "ParticipantsChoices",
        "locations":
          [ { "lineno": 131,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "Information about the booked service choices and participants. Available only when the booking includes multiple service variants." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "serviceChoices",
              "type": "bookings-custom-pricing.ServiceChoices",
              "doc": "Information about the booked service's choices. Includes the number of participants." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "Resource",
        "locations":
          [ { "lineno": 3,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "The resource assigned to the slot." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "id",
              "type": "string",
              "doc": "Booked resource ID." },
            { "name": "name",
              "type": "string",
              "doc": "Resource's name at the time of booking." },
            { "name": "email",
              "type": "string",
              "doc": "Resource's email at the time of booking." },
            { "name": "scheduleId",
              "type": "string",
              "doc": "Resource's schedule ID." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "Schedule",
        "locations":
          [ { "lineno": 25,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "The booked schedule. The booking is automatically assigned to the schedule's sessions." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "id",
              "type": "string",
              "doc": "Schedule ID." },
            { "name": "firstSession",
              "type": "string",
              "doc": "The start time of the first session in [RFC 3339](https://www.rfc-editor.org/rfc/rfc3339) format." },
            { "name": "lastSession",
              "type": "string",
              "doc": "The end time of the last session in [RFC 3339](https://www.rfc-editor.org/rfc/rfc3339) format." },
            { "name": "location",
              "type": "bookings-custom-pricing.Location",
              "doc": "Location where the schedule's sessions take place." },
            { "name": "serviceId",
              "type": "string",
              "doc": "Booked service ID." },
            { "name": "timezone",
              "type": "string",
              "doc": "The timezone according to which the slot was shown to the user when booking, and should be shown in future." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "ServiceChoices",
        "locations":
          [ { "lineno": 123,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "Information about the booked service's choices. Includes the number of participants." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "choices",
              "type":
                { "name": "Array",
                  "typeParams":
                    [ "bookings-custom-pricing.choice" ] },
              "doc": "Service choice for participants." },
            { "name": "numberOfParticipants",
              "type": "number",
              "doc": "Number of participants for this variant." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] },
      { "name": "Slot",
        "locations":
          [ { "lineno": 36,
              "filename": "custom-pricing.js" } ],
        "docs":
          { "description":
              [ "The booked slot, once booked becomes a session, The booking is automatically assigned to the session if it already exists, or creates a session if one doesn't already exist." ],
            "links": [],
            "examples": [],
            "extra":
              {  } },
        "members":
          [ { "name": "sessionId",
              "type": "string",
              "doc": "ID of the underlying session when session is a single session or generated from a recurring session. If sessionId is defined in the Create Booking request, the startDate, endDate, timezone, resource, and location fields are ignored and populated from the existing session's information." },
            { "name": "serviceId",
              "type": "string",
              "doc": "Service ID." },
            { "name": "scheduleId",
              "type": "string",
              "doc": "Schedule ID." },
            { "name": "timezone",
              "type": "string",
              "doc": "The timezone according to which the slot was shown to the user when booking, and should be shown in future." },
            { "name": "startDate",
              "type": "string",
              "doc": "The start time of this slot in [RFC 3339](https://www.rfc-editor.org/rfc/rfc3339) format." },
            { "name": "endDate",
              "type": "string",
              "doc": "The end time of this slot in [RFC 3339](https://www.rfc-editor.org/rfc/rfc3339) format." },
            { "name": "timezone",
              "type": "string",
              "doc": "The timezone according to which the slot was shown to the user when booking, and should be shown in future." },
            { "name": "updatedDate",
              "type": "string",
              "doc": "The date the booking was last updated." },
            { "name": "resource",
              "type": "bookings-custom-pricing.Resource",
              "doc": "The resource assigned to the slot." },
            { "name": "location",
              "type": "bookings-custom-pricing.Location",
              "doc": "Location where the slot's session takes place." } ],
        "extra":
          {  },
        "labels":
          [ "new" ] } ],
  "extra":
    {  } }